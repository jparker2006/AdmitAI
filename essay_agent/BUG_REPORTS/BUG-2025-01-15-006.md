# Bug Report BUG-2025-01-15-006

## BUG-2025-01-15-006

**Date**: 2025-01-15  
**Reporter**: Comprehensive Test Suite  
**Severity**: **High**  
**Status**: New

## Summary
Intent recognition system incorrectly skips brainstorm and outline steps, jumping directly to draft tool with insufficient context, leading to systematic failures

## Test Scenario
**Affected Scenarios**: HP-003, HP-004, HP-005 (3/5 happy path scenarios)  
**Pattern**: Users request essay creation but system skips planning steps  
**Test Command**: Multiple scenarios show workflow bypass issues

## Expected Behavior
Proper essay workflow should follow logical sequence:
1. **Context Gathering**: Understand user's essay topic and goals
2. **Brainstorming**: Generate relevant stories and experiences  
3. **Outline Creation**: Structure essay with clear organization
4. **Draft Generation**: Write essay based on brainstorm + outline
5. **Revision/Polish**: Improve and finalize content

## Actual Behavior
**Workflow Bypass Pattern**:
1. User provides essay topic: `"I want to write about my community art project for MIT"`
2. System incorrectly classifies as direct draft intent: `Intent: draft (confidence: 0.40)`
3. System skips brainstorm and outline steps entirely
4. Draft tool attempts to generate essay with empty outline: `'outline': {}`
5. Draft tool fails due to insufficient context and structure

## Specific Examples

### HP-003 (Creative Passionate - MIT Community)
```
User Input: "I want to write about my community art project for MIT"
Intent Classification: draft (confidence: 0.40)  // WRONG: Should be brainstorm
Tools Executed: draft only                        // MISSING: brainstorm, outline
Result: Draft succeeds but workflow incomplete
```

### HP-004 (Identity Explorer - Harvard Identity)  
```
User Input: "I want to write about my mental health advocacy for Harvard's diversity prompt"
Intent Classification: draft (confidence: 0.40)  // WRONG: Should be brainstorm  
Tools Executed: draft only                        // MISSING: brainstorm, outline
Result: Draft fails after 3 attempts - insufficient context
```

### HP-005 (Service Leader - Yale Passion)
```
User Input: "Write an essay about my homeless shelter work"
Intent Classification: draft (confidence: 0.40)  // WRONG: Should be brainstorm
Tools Executed: draft only                        // MISSING: brainstorm, outline  
Result: Draft succeeds but skips important planning
```

## Root Cause Analysis

### 1. Intent Recognition Logic Issues
**Problem**: System defaults to draft intent for complex essay requests
```python
# Expected Intent Classification:
"I want to write about X" → brainstorm intent (gather stories)
"Write an essay about Y" → brainstorm intent (plan first)

# Actual Intent Classification:
"I want to write about X" → draft intent (confidence: 0.40)
"Write an essay about Y" → draft intent (confidence: 0.40)
```

### 2. Missing Workflow Orchestration
**Problem**: No systematic workflow enforcement
- Draft tool called directly without prerequisites
- No validation that brainstorm/outline completed before draft
- No automatic workflow progression (brainstorm → outline → draft)

### 3. Context Inadequacy Detection
**Problem**: System doesn't recognize when insufficient context exists
- Empty outline passed to draft tool: `'outline': {}`
- No story selection from brainstorming
- Generic essay prompt fallback: `"Generate personal stories and experiences for college essays"`

## Impact Assessment
- **Essay Quality**: Poor essays due to skipped planning phases  
- **User Experience**: Missing guidance through proper essay development
- **Workflow Integrity**: Breaks established best practices for essay writing
- **Success Rate**: Contributes to systematic draft tool failures

## Technical Details

### Intent Recognition Issues
```python
# Intent confidence patterns showing problems:
Intent: draft (confidence: 0.40)  // Low confidence but still executed
Intent: draft (confidence: 0.30)  // Very low confidence, should trigger planning

# Should trigger brainstorm intent instead:
Intent: brainstorm (confidence: 0.60)  // Higher confidence for planning
```

### Missing Workflow Guards
```python
# Current approach - direct tool execution:
if intent == "draft":
    execute_draft_tool(empty_outline)  // No prerequisite check

# Better approach - workflow validation:
if intent == "draft" and not has_outline():
    execute_brainstorm_first()
    execute_outline_tool()
    then_execute_draft_tool()
```

## Investigation Areas
1. **Intent Classification**: Why are essay requests classified as draft instead of brainstorm?
2. **Workflow Engine**: Does the system have workflow orchestration capabilities?
3. **Context Detection**: How can system recognize when more planning is needed?
4. **User Journey**: What is the optimal conversation flow for essay creation?

## Proposed Solutions

### 1. Improve Intent Recognition
```python
# Essay creation triggers should default to brainstorm:
patterns = [
    "write.*essay about",
    "want to write about", 
    "help me.*essay.*about"
]
# These should trigger brainstorm_intent, not draft_intent
```

### 2. Add Workflow Orchestration
```python
def execute_essay_workflow(user_intent, context):
    if intent == "draft" and not context.has_brainstorm():
        return execute_brainstorm_first()
    elif intent == "draft" and not context.has_outline():
        return execute_outline_first()
    else:
        return execute_draft_tool()
```

### 3. Context Validation
```python
def validate_draft_prerequisites(context):
    if not context.outline or context.outline == {}:
        return "Need outline first"
    if not context.selected_stories:
        return "Need story selection first"
    return "Ready for draft"
```

## Related Issues
- **BUG-2025-01-15-003**: Empty outline parameter causes draft failures
- **Workflow Design**: System lacks proper essay development methodology

---

## Bug Report Checklist
- [x] Clear reproduction steps provided (multiple scenario examples)
- [x] Error messages/logs included (intent classification logs)
- [x] Impact assessment completed (breaks essay development workflow)
- [x] Severity level assigned (High - affects core user experience)
- [x] Technical analysis and solutions provided 